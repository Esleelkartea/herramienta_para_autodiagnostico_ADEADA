<?php/****************************************************************************************************//* include: salvarIndicador.php/* Theme: adeada/* Descripción: Guarda en la BD los valores del indicador/*/* Control de versiones:/* --------------------------------------------------------------------/* Autor                    Fecha                Acción/*/* Digital5 S.L.        30/06/2011    Creación/*/****************************************************************************************************/?><?phpfunction validarInd(){	global $strResultadoEnviarErrorInd;	$valido = true;		if (($_POST["ventas"] == 'NULL') || (!is_numeric($_POST["ventas"]))){		$valido = false;		$strResultadoEnviarErrorInd = $strResultadoEnviarErrorInd."<br/>Falta rellenar las ventas o dar un valor valido";	}		if (($_POST["facturas"] == 'NULL') || (!is_numeric($_POST["facturas"]))){		$valido = false;		$strResultadoEnviarErrorInd = $strResultadoEnviarErrorInd."<br/>Falta rellenar el n&ordm; de facturas o dar un valor valido";	}	if (($_POST["costes"] == 'NULL') || (!is_numeric($_POST["costes"]))){		$valido = false;		$strResultadoEnviarErrorInd = $strResultadoEnviarErrorInd."<br/>Falta rellenar los costes o dar un valor valido";	}	if (($_POST["clientes"] == 'NULL') || (!is_numeric($_POST["clientes"]))){		$valido = false;		$strResultadoEnviarErrorInd = $strResultadoEnviarErrorInd."<br/>Falta rellenar el n&ordm; de clientes o dar un valor valido";	}	if (($_POST["quejas"] == 'NULL') || (!is_numeric($_POST["quejas"]))){		$valido = false;		$strResultadoEnviarErrorInd = $strResultadoEnviarErrorInd."<br/>Falta rellenar el n&ordm; de quejas o dar un valor valido";	}	if (($_POST["sugerencias"] == 'NULL') || (!is_numeric($_POST["sugerencias"]))){		$valido = false;		$strResultadoEnviarErrorInd = $strResultadoEnviarErrorInd."<br/>Falta rellenar el n&ordm; de sugerencias o dar un valor valido";	}		if (($_POST["absentismo"] == 'NULL') || (!is_numeric($_POST["absentismo"]))){		$valido = false;		$strResultadoEnviarErrorInd = $strResultadoEnviarErrorInd."<br/>Falta rellenar el nivel de absentismo o dar un valor valido";	}	if (($_POST["rotacion"] == 'NULL') || (!is_numeric($_POST["rotacion"]))){		$valido = false;		$strResultadoEnviarErrorInd = $strResultadoEnviarErrorInd."<br/>Falta rellenar el nivel de rotaci(oacute;n o dar un valor valido";	}		return $valido;	}	function guardarInd(){    global $wpdb;    global $strResultadoEnviarInd;	global $strResultadoEnviarErrorInd;	    $sql = "SET AUTOCOMMIT=0;";    $wpdb->query($sql);     $sql = "BEGIN;";    $wpdb->query($sql); 		if ($_POST['id_indicador']!=null && $_POST['id_indicador']!=""){			$sql = "update adeada_indicadores set ";			$sql .= " id_usuario=".$_POST['id_usuario'].",";			$sql .= " ventas=".$_POST['ventas'].",";			$sql .= " facturas=".$_POST['facturas'].",";			$sql .= " costes=".$_POST['costes'].",";			$sql .= " satisfaccion_clientes=".$_POST['satisfaccion_clientes'].",";			$sql .= " clientes=".$_POST['clientes'].",";			$sql .= " quejas=".$_POST['quejas'].",";			$sql .= " satisfaccion_personal=".$_POST['satisfaccion_personal'].",";			$sql .= " sugerencias=".$_POST['sugerencias'].",";			$sql .= " absentismo=".$_POST['absentismo'].",";			$sql .= " rotacion=".$_POST['rotacion']." ";			$sql .= " where id_indicador = ".$_POST['id_indicador'];		}	else{		$sql = "insert into adeada_indicadores(id_usuario,ventas,facturas,costes,satisfaccion_clientes,clientes,quejas,satisfaccion_personal,sugerencias,absentismo,rotacion) values(";		$sql .= $_POST['id_usuario'].",".$_POST['ventas'].",".$_POST['facturas'].",".$_POST['costes'].",".$_POST['satisfaccion_clientes'].",".$_POST['clientes'].",".$_POST['quejas'].",".$_POST['satisfaccion_personal'].",".$_POST['sugerencias'].",".$_POST['absentismo'].",".$_POST['rotacion'].")";	 	}	$result = $wpdb->query($sql);	$strSalida = "";	if($result !== false){		$sql = "COMMIT;";		$wpdb->query($sql); 		$strSalida = "Se han guardado correctamente los indicadores";		$strElem = "<ul class='informe4'>";		$strElem = $strElem."<li>".$strSalida."</li>";		$strElem = $strElem."<li>Volver al listado de sus <a href='?page_id=45'>Diagn&oacute;sticos</a></li>";				$strElem = $strElem."</ul>";		$strResultadoEnviarInd = $strResultadoEnviarInd.$strElem;		}	else{		$sql = "ROLLBACK;";		$wpdb->query($sql); 			$strSalida = "NO se han guardado correctamente los indicadores";		$strElem = "<ul class='informe4'>";		$strElem = $strElem."<li>".$strSalida."</li>";		$strElem = $strElem."<li>Volver al listado de sus <a href='?page_id=45'>Diagn&oacute;sticos</a></li>";				$strElem = $strElem."</ul>";		$strResultadoEnviarErrorInd = $strResultadoEnviarErrorInd.$strElem;			return false;	}			return true;	}if (validarInd()){    global $strResultadoEnviarInd;	global $strResultadoEnviarErrorInd;	if (guardarInd())		echo $strResultadoEnviarInd;	else		echo $strResultadoEnviarErrorInd;}else{	global $strResultadoEnviarErrorInd;	echo $strResultadoEnviarErrorInd."<br/>No se han guardado los indicadores.";	}?>